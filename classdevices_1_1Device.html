<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>K-AIoT: devices.Device Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">K-AIoT<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacedevices.html">devices</a></li><li class="navelem"><a class="el" href="classdevices_1_1Device.html">Device</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a>  </div>
  <div class="headertitle"><div class="title">devices.Device Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This class represents a device in the system.  
 <a href="classdevices_1_1Device.html#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for devices.Device:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classdevices_1_1Device.png" usemap="#devices.Device_map" alt=""/>
  <map id="devices.Device_map" name="devices.Device_map">
<area href="classdevices_1_1Robot.html" title="A child class of the Device class, specifically for representing a device operating with ROS." alt="devices.Robot" shape="rect" coords="0,56,100,80"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9ace1efa06a1d4b1aa4a560c0e818ebf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#a9ace1efa06a1d4b1aa4a560c0e818ebf">__init__</a> (self, Optional[<a class="el" href="classbridge_1_1MqttOpcuaBridge.html">bridge.MqttOpcuaBridge</a>] bridge=None, Optional[List[Tuple[str, str]]] pubSubPairs=None, Optional[Optional[Type[<a class="el" href="classdevices_1_1OpcuaCallback.html">OpcuaCallback</a>]]] opcuaCallback=None)</td></tr>
<tr class="memdesc:a9ace1efa06a1d4b1aa4a560c0e818ebf"><td class="mdescLeft">&#160;</td><td class="mdescRight">The constructor for the Device class.  <br /></td></tr>
<tr class="separator:a9ace1efa06a1d4b1aa4a560c0e818ebf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a92646795c5c52dd27377f793a0e976"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#a9a92646795c5c52dd27377f793a0e976">asyncInit</a> (self)</td></tr>
<tr class="memdesc:a9a92646795c5c52dd27377f793a0e976"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronous initialisation method for the device.  <br /></td></tr>
<tr class="separator:a9a92646795c5c52dd27377f793a0e976"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab457352c269b917f81760e6d4b1a8d5f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#ab457352c269b917f81760e6d4b1a8d5f">setPubSubPairs</a> (self, Optional[List[Tuple[str, str]]] newPubSubPairs=None)</td></tr>
<tr class="separator:ab457352c269b917f81760e6d4b1a8d5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d21b3600206e195d0af8faccde22545"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#a9d21b3600206e195d0af8faccde22545">setBridge</a> (self, newBridge)</td></tr>
<tr class="memdesc:a9d21b3600206e195d0af8faccde22545"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setter method for the bridge attribute.  <br /></td></tr>
<tr class="separator:a9d21b3600206e195d0af8faccde22545"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad39a8cad6c2db691ba522494403d1bea"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#ad39a8cad6c2db691ba522494403d1bea">getPubSubPairs</a> (self)</td></tr>
<tr class="memdesc:ad39a8cad6c2db691ba522494403d1bea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter method for the pubSubPairs attribute.  <br /></td></tr>
<tr class="separator:ad39a8cad6c2db691ba522494403d1bea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba01c177556908651179fb8a6854d4b0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#aba01c177556908651179fb8a6854d4b0">getBridge</a> (self)</td></tr>
<tr class="memdesc:aba01c177556908651179fb8a6854d4b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter method for the bridge attribute.  <br /></td></tr>
<tr class="separator:aba01c177556908651179fb8a6854d4b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad20efc69b398b0237201f5008f100b00"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#ad20efc69b398b0237201f5008f100b00">typecastForNode</a> (self, node, payload)</td></tr>
<tr class="memdesc:ad20efc69b398b0237201f5008f100b00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method for typecasting MQTT payloads to OPC UA node data types.  <br /></td></tr>
<tr class="separator:ad20efc69b398b0237201f5008f100b00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a408b3059ed552216f535b4b4e1593848"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#a408b3059ed552216f535b4b4e1593848">mqttCallback</a> (self, client, userdata, message)</td></tr>
<tr class="memdesc:a408b3059ed552216f535b4b4e1593848"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function for MQTT messages.  <br /></td></tr>
<tr class="separator:a408b3059ed552216f535b4b4e1593848"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:aae10e8b0d85c0acd1a3b7219e1b25c22"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#aae10e8b0d85c0acd1a3b7219e1b25c22">_bridge</a></td></tr>
<tr class="separator:aae10e8b0d85c0acd1a3b7219e1b25c22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab7c11214ed415c2b3a9b6743b70748c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#aab7c11214ed415c2b3a9b6743b70748c">_pubSubPairs</a></td></tr>
<tr class="separator:aab7c11214ed415c2b3a9b6743b70748c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dce312a5ea52b0a1f57ae4195d292d1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#a6dce312a5ea52b0a1f57ae4195d292d1">_opcuaCallback</a></td></tr>
<tr class="separator:a6dce312a5ea52b0a1f57ae4195d292d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca9b4160d4f0b423714e6eec78dca3c8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdevices_1_1Device.html#aca9b4160d4f0b423714e6eec78dca3c8">_loop</a></td></tr>
<tr class="separator:aca9b4160d4f0b423714e6eec78dca3c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class represents a device in the system. </p>
<p>It holds the MQTT-Opcua bridge object and the set of publisher/subscriber pairs for the device. </p>

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00036">36</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a9ace1efa06a1d4b1aa4a560c0e818ebf" name="a9ace1efa06a1d4b1aa4a560c0e818ebf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ace1efa06a1d4b1aa4a560c0e818ebf">&#9670;&#160;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Optional[<a class="el" href="classbridge_1_1MqttOpcuaBridge.html">bridge.MqttOpcuaBridge</a>] &#160;</td>
          <td class="paramname"><em>bridge</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Optional[List[Tuple[str, str]]] &#160;</td>
          <td class="paramname"><em>pubSubPairs</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Optional[Optional[Type[<a class="el" href="classdevices_1_1OpcuaCallback.html">OpcuaCallback</a>]]] &#160;</td>
          <td class="paramname"><em>opcuaCallback</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The constructor for the Device class. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bridge</td><td>An instance of the MqttOpcuaBridge class, providing the MQTT-Opcua bridge for this device. </td></tr>
    <tr><td class="paramname">pubSubPairs</td><td>A list of tuples, where each tuple is a publisher/subscriber pair associated with the device. </td></tr>
    <tr><td class="paramname">opcuaCallback</td><td>An instance of the OpcuaCallback class. If not provided, a new OpcuaCallback instance is created. </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="classdevices_1_1Robot.html#af16009a5de6f791eea759d37ef0d1052">devices.Robot</a>.</p>

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00042">42</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   42</span>    <span class="keyword">def </span>__init__(self, bridge: Optional[<a class="code hl_class" href="classbridge_1_1MqttOpcuaBridge.html">bridge.MqttOpcuaBridge</a>] = <span class="keywordtype">None</span>, pubSubPairs: Optional[List[Tuple[str, str]]] = <span class="keywordtype">None</span>, opcuaCallback: Optional[Optional[Type[OpcuaCallback]]] = <span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">   43</span>        self._bridge = bridge</div>
<div class="line"><span class="lineno">   44</span>        self._pubSubPairs = pubSubPairs</div>
<div class="line"><span class="lineno">   45</span> </div>
<div class="line"><span class="lineno">   46</span>        <span class="keywordflow">if</span> opcuaCallback <span class="keywordflow">is</span> <span class="keywordtype">None</span>: <span class="comment"># If there is no callback passed to the device upon initialisation create one and assign it to the device. Otherwise assign the one passed in initialisation.</span></div>
<div class="line"><span class="lineno">   47</span>            self._opcuaCallback = OpcuaCallback(self)</div>
<div class="line"><span class="lineno">   48</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   49</span>            self._opcuaCallback = opcuaCallback </div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>        self._loop = asyncio.get_event_loop() <span class="comment"># Attains the current event loop</span></div>
<div class="line"><span class="lineno">   52</span>        self._loop.create_task(self.asyncInit())  <span class="comment"># Creates a task within the event loop that runs </span></div>
<div class="line"><span class="lineno">   53</span>    </div>
<div class="ttc" id="aclassbridge_1_1MqttOpcuaBridge_html"><div class="ttname"><a href="classbridge_1_1MqttOpcuaBridge.html">bridge.MqttOpcuaBridge</a></div><div class="ttdoc">This class acts as a bridge between an OPC UA and MQTT client pair.</div><div class="ttdef"><b>Definition:</b> <a href="classbridge_1_1MqttOpcuaBridge.html#l00003">bridge.py:3</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a9a92646795c5c52dd27377f793a0e976" name="a9a92646795c5c52dd27377f793a0e976"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a92646795c5c52dd27377f793a0e976">&#9670;&#160;</a></span>asyncInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device.asyncInit </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Asynchronous initialisation method for the device. </p>
<p>This method is called to set the publisher/subscriber pairs of the device. </p>

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00056">56</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   56</span>    <span class="keyword">async def </span>asyncInit(self): <span class="comment">#POSSIBLY DELETE AND CALL SETPUBSUBPAIRS IN LOOP.CREATE_TASK IN INIT</span></div>
<div class="line"><span class="lineno">   57</span>        await self.setPubSubPairs(self._pubSubPairs)</div>
<div class="line"><span class="lineno">   58</span>    </div>
<div class="line"><span class="lineno">   59</span> </div>
<div class="line"><span class="lineno">   60</span>        </div>
</div><!-- fragment -->
</div>
</div>
<a id="aba01c177556908651179fb8a6854d4b0" name="aba01c177556908651179fb8a6854d4b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba01c177556908651179fb8a6854d4b0">&#9670;&#160;</a></span>getBridge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device.getBridge </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter method for the bridge attribute. </p>
<dl class="section return"><dt>Returns</dt><dd>Returns the current bridge for the device. </dd></dl>

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00119">119</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  119</span>    <span class="keyword">def </span>getBridge(self):</div>
<div class="line"><span class="lineno">  120</span>        <span class="keywordflow">return</span> self._bridge</div>
<div class="line"><span class="lineno">  121</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ad39a8cad6c2db691ba522494403d1bea" name="ad39a8cad6c2db691ba522494403d1bea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad39a8cad6c2db691ba522494403d1bea">&#9670;&#160;</a></span>getPubSubPairs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device.getPubSubPairs </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter method for the pubSubPairs attribute. </p>
<dl class="section return"><dt>Returns</dt><dd>Returns the current list of publisher/subscriber pairs of the device. </dd></dl>

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00114">114</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  114</span>    <span class="keyword">def </span>getPubSubPairs(self):</div>
<div class="line"><span class="lineno">  115</span>        <span class="keywordflow">return</span> self._pubSubPairs</div>
<div class="line"><span class="lineno">  116</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a408b3059ed552216f535b4b4e1593848" name="a408b3059ed552216f535b4b4e1593848"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a408b3059ed552216f535b4b4e1593848">&#9670;&#160;</a></span>mqttCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device.mqttCallback </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>userdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for MQTT messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client</td><td>The MQTT client instance. </td></tr>
    <tr><td class="paramname">userdata</td><td>The user data associated with the MQTT client. </td></tr>
    <tr><td class="paramname">message</td><td>The received MQTT message. This method is called when an MQTT message is received. It extracts the necessary information from the MQTT message, such as the topic and payload. It then processes the message and publishes the relevant data to the associated OPC UA nodes. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00152">152</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  152</span>    <span class="keyword">def </span>mqttCallback(self, client, userdata, message):</div>
<div class="line"><span class="lineno">  153</span>        <span class="keywordflow">try</span>:    </div>
<div class="line"><span class="lineno">  154</span>            opcuaNodes = self._pubSubPairs[message.topic] </div>
<div class="line"><span class="lineno">  155</span>            rosMsgDict = msgpack.unpackb(message.payload, raw=<span class="keyword">False</span>) </div>
<div class="line"><span class="lineno">  156</span> </div>
<div class="line"><span class="lineno">  157</span>            print(f<span class="stringliteral">&#39;Received ROS message on topic {message.topic}:&#39;</span>)  </div>
<div class="line"><span class="lineno">  158</span>            <span class="keywordflow">for</span> node <span class="keywordflow">in</span> opcuaNodes:</div>
<div class="line"><span class="lineno">  159</span>                keyPath = [x.lower() <span class="keywordflow">for</span> x <span class="keywordflow">in</span> re.split(<span class="stringliteral">r&#39;(?=[A-Z])&#39;</span>, node[<span class="stringliteral">&quot;name&quot;</span>])] <span class="comment"># Takes the OPC UA node name and splits it into a list of parts, each representing a subdictionary within the corresponding ROS message. Makes it possible to differentiate between two keys of the same name but within different parts of a message. Separator is an uppercase letter since ROS messages use &#39;-&#39; within names and NxTTech will not accept any other special characters in node names.</span></div>
<div class="line"><span class="lineno">  160</span>                containerToSearch = rosMsgDict</div>
<div class="line"><span class="lineno">  161</span>                <span class="keywordflow">for</span> searchTerm <span class="keywordflow">in</span> keyPath: <span class="comment"># Finds the value key pair in the ROS message dictionary received.</span></div>
<div class="line"><span class="lineno">  162</span>                    <span class="keywordflow">if</span> searchTerm == <span class="stringliteral">&quot;std_msgs&quot;</span>:</div>
<div class="line"><span class="lineno">  163</span>                        key, hit = <span class="stringliteral">&quot;data&quot;</span>, containerToSearch[<span class="stringliteral">&#39;data&#39;</span>]</div>
<div class="line"><span class="lineno">  164</span>                        <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  165</span>                    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  166</span>                        containerToSearch = self.getRosDictionaryValue(containerToSearch, searchTerm)</div>
<div class="line"><span class="lineno">  167</span>                        key, hit = searchTerm, containerToSearch</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>                print(f<span class="stringliteral">&#39;Publishing {key} = {hit} to node: {node[&quot;name&quot;]}\n&#39;</span>)</div>
<div class="line"><span class="lineno">  170</span> </div>
<div class="line"><span class="lineno">  171</span>                payloadValue = super().typecastForNode(node, hit)              </div>
<div class="line"><span class="lineno">  172</span>                variantFormattedPayload = ua.DataValue(ua.Variant(payloadValue, node[<span class="stringliteral">&quot;variantType&quot;</span>]))</div>
<div class="line"><span class="lineno">  173</span>                self._loop.create_task(node[<span class="stringliteral">&quot;node&quot;</span>].write_value(variantFormattedPayload)) <span class="comment"># Create a task in the current event loop that writes the correctly formatted message to each associated subscribing OPC UA node iterated through.</span></div>
<div class="line"><span class="lineno">  174</span>        </div>
<div class="line"><span class="lineno">  175</span>        <span class="keywordflow">except</span> ValueError:</div>
<div class="line"><span class="lineno">  176</span>            print(<span class="stringliteral">&quot;Error: Could not convert payload to appropriate type&quot;</span>)</div>
<div class="line"><span class="lineno">  177</span>            <span class="keywordflow">return</span></div>
<div class="line"><span class="lineno">  178</span> </div>
<div class="line"><span class="lineno">  179</span>      </div>
<div class="line"><span class="lineno">  180</span>    </div>
<div class="line"><span class="lineno">  181</span>       </div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d21b3600206e195d0af8faccde22545" name="a9d21b3600206e195d0af8faccde22545"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d21b3600206e195d0af8faccde22545">&#9670;&#160;</a></span>setBridge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device.setBridge </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>newBridge</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setter method for the bridge attribute. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">newBridge</td><td>An instance of MqttOpcuaBridge to be set as the bridge for the device. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00109">109</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  109</span>    <span class="keyword">def </span>setBridge(self, newBridge):</div>
<div class="line"><span class="lineno">  110</span>        self._bridge = newBridge</div>
<div class="line"><span class="lineno">  111</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ab457352c269b917f81760e6d4b1a8d5f" name="ab457352c269b917f81760e6d4b1a8d5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab457352c269b917f81760e6d4b1a8d5f">&#9670;&#160;</a></span>setPubSubPairs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device.setPubSubPairs </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Optional[List[Tuple[str, str]]] &#160;</td>
          <td class="paramname"><em>newPubSubPairs</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00063">63</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   63</span>    <span class="keyword">async def </span>setPubSubPairs(self, newPubSubPairs: Optional[List[Tuple[str, str]]] = <span class="keywordtype">None</span>):       </div>
<div class="line"><span class="lineno">   64</span>        tempDict = {}</div>
<div class="line"><span class="lineno">   65</span>        formattedTempDict = {}</div>
<div class="line"><span class="lineno">   66</span>        <span class="keywordflow">if</span> newPubSubPairs <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">   67</span>            <span class="keywordflow">for</span> pub, sub <span class="keywordflow">in</span> newPubSubPairs:    </div>
<div class="line"><span class="lineno">   68</span>                <span class="keywordflow">if</span> <span class="stringliteral">&quot;/&quot;</span> <span class="keywordflow">in</span> pub: <span class="comment"># If the MQTT topic is the publisher, subscribe to MQTT topic and add a callback function for it</span></div>
<div class="line"><span class="lineno">   69</span>                    self._bridge.getMqttClient().message_callback_add(pub, self.mqttCallback)</div>
<div class="line"><span class="lineno">   70</span>                    self._bridge.getMqttClient().subscribe(pub)</div>
<div class="line"><span class="lineno">   71</span>                    <span class="comment"># Convert the OPC UA UUID string to a node ID</span></div>
<div class="line"><span class="lineno">   72</span>                    nodeId = ua.NodeId(UUID(sub), 2, ua.NodeIdType.Guid)</div>
<div class="line"><span class="lineno">   73</span>                    node = self._bridge.getOpcuaClient().get_node(nodeId)</div>
<div class="line"><span class="lineno">   74</span>                    nodeName = (await node.read_browse_name()).Name                  </div>
<div class="line"><span class="lineno">   75</span>                    variantType = await node.read_data_type_as_variant_type()</div>
<div class="line"><span class="lineno">   76</span>                    nodeDict = {<span class="stringliteral">&quot;node&quot;</span>: node, <span class="stringliteral">&quot;name&quot;</span>: nodeName, <span class="stringliteral">&quot;variantType&quot;</span>: variantType}</div>
<div class="line"><span class="lineno">   77</span>                    <span class="keywordflow">if</span> pub <span class="keywordflow">in</span> tempDict: <span class="comment"># Check if the MQTT topic is already listed in the temporary pubSub dictionary and if so, if the subscribing node is already associated with it. If it isn&#39;t, add it to the list of subscribing nodes for that MQTT topic. </span></div>
<div class="line"><span class="lineno">   78</span>                        <span class="keywordflow">if</span> node <span class="keywordflow">not</span> <span class="keywordflow">in</span> tempDict[pub]: <span class="comment">#DOUBLE CHECK it actually finds as maybe should look for nodeDict</span></div>
<div class="line"><span class="lineno">   79</span>                            tempDict[pub].append(nodeDict)</div>
<div class="line"><span class="lineno">   80</span>                    <span class="keywordflow">else</span>:   <span class="comment"># If the MQTT topic isn&#39;t in the temporary dictionary, add it and the subscribing node as its first list entry.</span></div>
<div class="line"><span class="lineno">   81</span>                        tempDict[pub] = [nodeDict]</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>                <span class="keywordflow">elif</span> <span class="stringliteral">&quot;/&quot;</span> <span class="keywordflow">in</span> sub: <span class="comment"># If the MQTT topic is the subscriber </span></div>
<div class="line"><span class="lineno">   84</span>                    nodeId = ua.NodeId(UUID(pub), 2, ua.NodeIdType.Guid) <span class="comment"># Convert the OPC UA UUID string to a node ID</span></div>
<div class="line"><span class="lineno">   85</span>                    node = self._bridge.getOpcuaClient().get_node(nodeId) <span class="comment"># Get the node for that nodeId</span></div>
<div class="line"><span class="lineno">   86</span>                    subscription = await self._bridge.getOpcuaClient().create_subscription(period=0, handler=self._opcuaCallback, publishing=<span class="keyword">True</span>) <span class="comment"># Create a subscription and assign the device&#39;s OPC UA handler to manage it.</span></div>
<div class="line"><span class="lineno">   87</span>                    </div>
<div class="line"><span class="lineno">   88</span>                    await subscription.subscribe_data_change(node) <span class="comment"># Use the subscription to subscribe to any change in data value for the node.</span></div>
<div class="line"><span class="lineno">   89</span>                    <span class="keywordflow">if</span> node <span class="keywordflow">in</span> tempDict: <span class="comment"># If the OPC UA node is already listed in the temporary dictionary, and the MQTT topic subscriber isn&#39;t already associated with it, append the MQTT topic to the node&#39;s list of subscribers.</span></div>
<div class="line"><span class="lineno">   90</span>                        <span class="keywordflow">if</span> sub <span class="keywordflow">not</span> <span class="keywordflow">in</span> tempDict[node]:</div>
<div class="line"><span class="lineno">   91</span>                            tempDict[node].append(sub)</div>
<div class="line"><span class="lineno">   92</span>                    <span class="keywordflow">else</span>:   <span class="comment"># Otherwise create a new dictionary entry for the OPC UA node publisher and MQTT topic subscriber.</span></div>
<div class="line"><span class="lineno">   93</span>                        tempDict[node] = [sub] </div>
<div class="line"><span class="lineno">   94</span>    </div>
<div class="line"><span class="lineno">   95</span>        <span class="comment">#Convert all list keys and values to tuples</span></div>
<div class="line"><span class="lineno">   96</span>        <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> tempDict.items():</div>
<div class="line"><span class="lineno">   97</span>            <span class="keywordflow">if</span> isinstance(key, list):</div>
<div class="line"><span class="lineno">   98</span>                key = tuple(key)</div>
<div class="line"><span class="lineno">   99</span>            <span class="keywordflow">elif</span> isinstance(value, list):</div>
<div class="line"><span class="lineno">  100</span>                value = tuple(value)</div>
<div class="line"><span class="lineno">  101</span> </div>
<div class="line"><span class="lineno">  102</span>            formattedTempDict[key] = value</div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span>        self._pubSubPairs = formattedTempDict</div>
<div class="line"><span class="lineno">  105</span> </div>
<div class="line"><span class="lineno">  106</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ad20efc69b398b0237201f5008f100b00" name="ad20efc69b398b0237201f5008f100b00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad20efc69b398b0237201f5008f100b00">&#9670;&#160;</a></span>typecastForNode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device.typecastForNode </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>payload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Method for typecasting MQTT payloads to OPC UA node data types. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>The node which is receiving the payload. </td></tr>
    <tr><td class="paramname">payload</td><td>The MQTT message payload to be typecasted. This method takes an OPC UA node and an MQTT payload as parameters, and typecasts the payload to the node's data type. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the payload after being typecasted to the appropriate data type. If the node's data type is not recognized, the method returns None. </dd></dl>

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00127">127</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  127</span>    <span class="keyword">def </span>typecastForNode(self, node, payload):</div>
<div class="line"><span class="lineno">  128</span>       </div>
<div class="line"><span class="lineno">  129</span>        match node[<span class="stringliteral">&quot;variantType&quot;</span>].name:</div>
<div class="line"><span class="lineno">  130</span>            case <span class="stringliteral">&quot;Float&quot;</span>:</div>
<div class="line"><span class="lineno">  131</span>                <span class="keywordflow">return</span> float(payload) </div>
<div class="line"><span class="lineno">  132</span>            case <span class="stringliteral">&quot;String&quot;</span>:</div>
<div class="line"><span class="lineno">  133</span>                <span class="keywordflow">return</span> str(payload)</div>
<div class="line"><span class="lineno">  134</span>            case <span class="stringliteral">&quot;Boolean&quot;</span>:</div>
<div class="line"><span class="lineno">  135</span>                <span class="keywordflow">return</span> bool(payload)</div>
<div class="line"><span class="lineno">  136</span>            case <span class="stringliteral">&quot;Double&quot;</span>:</div>
<div class="line"><span class="lineno">  137</span>                <span class="keywordflow">return</span> float(payload)</div>
<div class="line"><span class="lineno">  138</span>            case <span class="stringliteral">&quot;Byte&quot;</span>:</div>
<div class="line"><span class="lineno">  139</span>                <span class="keywordflow">return</span> int(payload)</div>
<div class="line"><span class="lineno">  140</span>            case _:</div>
<div class="line"><span class="lineno">  141</span>                print(<span class="stringliteral">&quot;Node is of an unknown data type so cannot be handled.&quot;</span>)</div>
<div class="line"><span class="lineno">  142</span>                <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a id="aae10e8b0d85c0acd1a3b7219e1b25c22" name="aae10e8b0d85c0acd1a3b7219e1b25c22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae10e8b0d85c0acd1a3b7219e1b25c22">&#9670;&#160;</a></span>_bridge</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device._bridge</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00043">43</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>

</div>
</div>
<a id="aca9b4160d4f0b423714e6eec78dca3c8" name="aca9b4160d4f0b423714e6eec78dca3c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca9b4160d4f0b423714e6eec78dca3c8">&#9670;&#160;</a></span>_loop</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device._loop</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00051">51</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>

</div>
</div>
<a id="a6dce312a5ea52b0a1f57ae4195d292d1" name="a6dce312a5ea52b0a1f57ae4195d292d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6dce312a5ea52b0a1f57ae4195d292d1">&#9670;&#160;</a></span>_opcuaCallback</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device._opcuaCallback</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00047">47</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>

</div>
</div>
<a id="aab7c11214ed415c2b3a9b6743b70748c" name="aab7c11214ed415c2b3a9b6743b70748c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab7c11214ed415c2b3a9b6743b70748c">&#9670;&#160;</a></span>_pubSubPairs</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">devices.Device._pubSubPairs</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="devices_8py_source.html#l00044">44</a> of file <a class="el" href="devices_8py_source.html">devices.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/<a class="el" href="devices_8py_source.html">devices.py</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
